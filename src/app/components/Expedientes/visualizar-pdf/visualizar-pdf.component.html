<div class="wrapper">
  <app-barra-lateral></app-barra-lateral>

  <div class="main">
    <nav class="navbar navbar-expand-lg p-0" style="background-color: #001f3f;">
      <div class="container-fluid p-0 d-flex justify-content-between align-items-center">
        <!-- Logo -->
        <a class="navbar-brand ms-3" href="/principal">
          <img src="logo/logoLexVargasV.png" alt="LexVargas Logo" width="200" class="d-inline-block align-text-top">
        </a>

        <form class="d-flex me-3">
          <input 
            class="form-control me-2" 
            type="search" 
            placeholder="Buscar expediente por número, nombre, cliente o abogado..." 
            aria-label="Buscar"
            [(ngModel)]="terminoBusqueda"
            (input)="buscar()"
            name="buscador"
          >
          <button class="btn btn-light" type="button" (click)="buscar()">
            <i class="fa fa-search"></i>
          </button>
        </form>
      </div>
    </nav>

    <div class="p-3">
      <app-breadcrumbs></app-breadcrumbs>
      
      <!-- Botón para mostrar/ocultar filtros -->
      <button class="btn btn-secondary mb-3" (click)="toggleFiltros()">
        {{ mostrarFiltros ? 'Ocultar Filtros' : 'Mostrar Filtros' }}
      </button>
      
      <!-- Panel de filtros (inicialmente oculto) -->
      <div class="filtros-container mb-4" [class.show]="mostrarFiltros">
        <div class="card">
          <div class="card-header">
            <h3>Filtrar Expedientes</h3>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                <label for="filtroEstado" class="form-label">Estado</label>
                <select id="filtroEstado" class="form-select" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
                  <option value="">Todos</option>
                  <option value="Prioridad Alta">Prioridad Alta</option>
                  <option value="Archivado">Archivado</option>
                  <option value="En Proceso">En Proceso</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="filtroFecha" class="form-label">Fecha de creación</label>
                <input type="date" id="filtroFecha" class="form-control" [(ngModel)]="filtroFecha" (change)="aplicarFiltros()">
              </div>
              <div class="col-md-4">
                <label for="filtroAbogado" class="form-label">Abogado</label>
                <input type="text" id="filtroAbogado" class="form-control" placeholder="Filtrar por abogado" 
                  [(ngModel)]="filtroAbogado" (input)="aplicarFiltros()">
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Contador de resultados -->
      <div class="alert alert-info" *ngIf="expedientesFiltrados.length > 0">
        Mostrando {{ expedientesFiltrados.length }} de {{ expedientes.length }} expedientes
      </div>
      
      <div class="card-container">
        <div *ngFor="let expediente of expedientesFiltrados" class="card" 
             [ngClass]="{'card-prioridad-alta': expediente.estado.toLowerCase() === 'prioridad alta'}"
             (mouseenter)="onMouseEnter(expediente.idExpediente)"
             (mouseleave)="onMouseLeave(expediente.idExpediente)">
          <div class="card-header">
            <h2>{{ expediente.nombreExpediente }} ({{ expediente.numeroExpediente }})</h2>
          </div>
          <div class="card-body">
            <p>Fecha de creación: {{ expediente.fechaCreacion }}</p>
            <p>Estado: <strong>{{ expediente.estado || 'Prioridad Alta' }}</strong></p>
            <p>Descripción: <strong>{{ expediente.descripcion || 'Sin descripción' }}</strong></p>
            <p>Datos del Abogado: <strong>{{ expediente.datosAbogado }}</strong></p>
            <p>Datos del Cliente: <strong>{{ expediente.datosCliente }}</strong></p>
          </div>
          <div class="card-footer d-flex justify-content-end gap-2">
            <a [routerLink]="['/expediente', expediente.idExpediente]" class="btn btn-primary">Ver más</a>
            <button class="btn-actualizar" (click)="actualizarExpediente(expediente.idExpediente)">Actualizar</button>
            <button class="btn-eliminar" (click)="confirmarEliminacion(expediente.idExpediente)">Eliminar</button>
          </div>
          
          <!-- Detalles adicionales que aparecen al pasar el mouse -->
          <div class="card-detalles" *ngIf="expedienteHover === expediente.idExpediente">
            <div class="detalles-contenido">
              <h4>Detalles adicionales</h4>
              <p><strong>Última actualización:</strong> {{ expediente.ultimaActualizacion || 'No disponible' }}</p>
              <p><strong>Próxima audiencia:</strong> {{ expediente.proximaAudiencia || 'No programada' }}</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mensaje cuando no hay resultados -->
      <div class="alert alert-warning" *ngIf="expedientesFiltrados.length === 0">
        No se encontraron expedientes que coincidan con los criterios de búsqueda.
      </div>
    </div>
  </div>
  <!-- Modal Reutilizado para Audiencias (usa el mismo que tienes para PDF) -->
<div class="modal fade" id="audienciaModal" tabindex="-1" aria-labelledby="audienciaModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="audienciaModalLabel">Programar Próxima Audiencia</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="fechaAudiencia" class="form-label">Fecha de la próxima audiencia</label>
          <input type="date" class="form-control" id="fechaAudiencia" 
                 [(ngModel)]="fechaAudiencia" name="fechaAudiencia">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModalAudiencia()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="guardarAudiencia()">Guardar</button>
      </div>
    </div>
  </div>
</div>
</div>
